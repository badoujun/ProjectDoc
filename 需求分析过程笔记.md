# 1.用户注册（不拦截）

1. 为了方便用户使用采用手机号注册，但是手机号注册。

```shell
# 短信验证码实现流程
1、构造手机验证码，生成一个6位的随机数字串；
2、使用接口向短信平台发送手机号和验证码，然后短信平台再把验证码发送到制定手机号上
3、将手机号验证码、操作时间存入Session中，作为后面验证使用；
'2、3步骤一般是通过MQ来并发处理，并做一个流量削峰'
4、接收用户填写的验证码、手机号及其他注册数据；
5、对比提交的验证码与Session中的验证码是否一致，同时判断提交动作是否在有效期内；
'5一般是写入redis中'
6、验证码正确且在有效期内，请求通过，处理相应的业务。
# 本地可能会出现的问题
1. 更换账号绑定的手机
2. 账号注册后应该可以设置用户名和密码
- 如果手机是用户名，那么更改时就直接更改手机，用新手机号登录
- 如果是用户自己定义的唯一用户名，那么更换手机后还可以用原来的用户名密码登录
3. 是在用户注册时输入用户名和密码，还是在验证成功后输入手机号绑定的用户名和密码
# 返回的参数
- 返回到登录页面，需要重新登录
- 或者注册完成后返回用户名和密码记录到手机本地，跳转到登录页面进行自动登录
# 第三方登录

#用手机号包裹账号信息还是账号信息包裹手机号
因为我们是做手机移动端的，都会有手机号，而且手机号现在本身就存在唯一性。
```

# 2.登陆（不拦截）

1. app保持长时间登录的方法

```shell
2017-10-27 13:16 案秀云 阅读(3679) 评论(0) 编辑 收藏
`我们在使用App时，一次登录后App如果不主动退出登录或者清除数据，App会在很长一段时间内保持登录状态，或者让用户感觉到登录一次就不用每次都输入用户密码才能进行登录。银行、金融涉及到支付类的App一般不支持这种长时间的登录状态保持。对于保持长期登录的技术实现方式，除了和前端技术有关，还涉及到前后台的通讯连接方式、后台提供的服务方式等有关。比如前端App是前端技术是原生加H5实现的，那选择的技术可能和纯原生的不一样。还有如果后端使用了sso（单点登录方式）技术那就和后端使用了webservice、Socket的方式不一样，具体实现上有时候需要综合考虑。总结出来一般的登录保持功能有如下的实现方式：`
# 一、利用Cookie机制实现
'我们知道cookie是为了解决http无状态的一种技术，被电商、oa等web应用广泛使用。如果我们的App和后端通讯采用的http通讯方式，可以利用cookie技术进行登录状态保持。比如我们可以把sessionID和有效期保存在cookie中，发给前端App，前端App收到后保存在本地。当访问后端服务把sessionID和有效期作为参数传给后台进行认证。直到sessionID失效，用户都不需要重新登录。'
# 二、用户名和密码
'如果App和后端通信不是通过http协议进行的，那cookie机制可能就不太适合。利用用户名和密码保持登录是指用户在第一次登录成功时，把用户名和密码保存的本地，下次用户打开App时登录利用保存的用户名和密码在后台自动完成。这种方式需要考虑用户名和密码的安全问题，防止信息被破解。'
# 三、token方式
'token方式在app认证上用的比较普遍，App初始登录时，提交账号和密码数据给服务端，服务端根据定义的的策略生成一个token字符串，token字符串中可以包含用户信息、设备ID等信息以保证用户的唯一性。服务端并对token设置一定的期限。服务端把生成的token字符串传给客户端，客户端保存token字符串，并在接下来的请求中带上这个字符串。相对于在App本地token的安全性更高了。
# 四、带来的问题
- 服务端数据持久化问题
- 客户端防拷贝问题
- 拦截破解问题
```

2. 返回的数据哪些需要处理

```shell
`比如手机号码，是全部显示还是部分显示，部分显示是在后端进行处理后返回还是前段做隐藏`
```

# 3.地址修改

> 修改后是否还在原页面，如果在原页面那么需要返回修改后的内容。

# 4.听课人分析

```shell
'听课人注册包含姓名和身份证号，前端查询时是否返回身份证号？'
```

# 5.收藏商家机构

```shell
1. 新增商家机构只需要添加商家机构的id就行了
2. 查询全部商家机构根据token拿到用户信息，通过用户信息拿到userid，根据id查收藏机构表找出全部的商家机构id，再去关联商家表
3. 商家评分计算平均值
4. 当月购课人数查当月课时订单课时表。每一节课就是一个单独的商品。
# 删除商家机构
1. 删除是假删除，也就是每次添加看供应商是否存在，也就是状态为0的时候，当添加时把0改为1，删除吧1改为0
```

# 6.游览记录-需考虑

```shell
`游览记录的添加使用切面的方式进行记录`
# 同事查出的数据有日期和课程，日期和课程又要按照时间排序。还要满足按天分组。
- 先封装一个Map<String,Object>,String 就为日期

- 所有数据用Object接收
- 按日期为userId+日期
```

# 7.网站备案、80端口备案、体现银行

> 1.需要购买服务器备案，目前就8核16G，互联网带宽20M，后面再扩。
>
> 2.签约银行要找银行去谈

# 8.机构详情返回参数

> 返回值相同可以做成一个接口

## 8.1 星级总数交于后端

> 后台存储的是整个星级评分的和，那么除的工作就可以放在前段或者后端。推荐放在后端，因为如果星级评分计算规则要修改的话还要修改前段代码。

## 8.2 设计到分页要加字段

> pageNum、pageSize

## 8.3 用户评论展示层级问题



## 8.4 相似机构过滤条件

## 8.5 精选机构过滤条件

> 未指定过滤规则，请求参数假定为无

# 9.签名参数生成

# 10./user/updateInfo接口

> 1. 是否需要对密码信息进行验证
>
> ​       不需要再验证，因为token那边已经验证过一次。当然可能手机被别人拿去设置密码了，但是除非设置密保问题，不然没办法
>
> 2. 是否对密码进行加密，如果加密用什么加密加几次

# 11.异常

> 1. 还有，所有的 service 里面直接往外抛异常，外面如果没有业务逻辑需要，就不需要去捕获。
> 2. 抛的异常要么装异常封装到BizException 中，或者在注解中指定 Exception  不然可能不会回滚

# 12.